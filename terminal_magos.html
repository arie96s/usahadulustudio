<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAGOS | CONTROL TERMINAL</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

    <style>
        :root { --m-green: #25D366; --m-border: #222; }
        body { background: #000; color: #fff; font-family: 'Inter', sans-serif; margin: 0; padding: 0; }
        .terminal-wrapper { max-width: 1000px; margin: 40px auto; padding: 20px; }
        
        /* Layout Grid */
        .terminal-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; }
        .panel { background: #080808; border: 1px dashed var(--m-border); padding: 25px; border-radius: 20px; }
        
        h1 { font-size: 18px; letter-spacing: 3px; font-weight: 900; margin-bottom: 30px; border-left: 4px solid #fff; padding-left: 15px; }
        label { font-size: 9px; color: #555; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; display: block; margin-bottom: 8px; }
        
        input, select, textarea { 
            width: 100%; background: #000; border: 1px solid #1a1a1a; padding: 14px; 
            color: #fff; border-radius: 8px; font-family: monospace; font-size: 14px; margin-bottom: 15px;
        }

        .btn-group { display: flex; flex-direction: column; gap: 12px; }
        .btn-main { 
            padding: 20px; border-radius: 12px; font-weight: 900; font-size: 11px; 
            text-transform: uppercase; cursor: pointer; border: none; transition: 0.3s;
        }
        .btn-invoice { background: #fff; color: #000; }
        .btn-label { background: transparent; color: #fff; border: 1px solid #333; }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            .terminal-grid { grid-template-columns: 1fr; }
            .mobile-row { grid-template-columns: 1fr !important; }
            #liveTotal { font-size: 20px !important; text-align: center; }
        }
    </style>
</head>
<body>

<div class="terminal-wrapper">
    <h1>CONTROL_CENTER</h1>
    <div class="terminal-grid">
        <div class="panel">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;" class="mobile-row">
                <div>
                    <label>ORDER_ID</label>
                    <input type="text" id="orderID" value="#MG-">
                </div>
                <div>
                    <label>DATE</label>
                    <input type="text" id="orderDate" readonly>
                </div>
            </div>
            <label>CUSTOMER_NAME</label>
            <input type="text" id="custName" placeholder="NAMA PENERIMA">
            <label>PHONE_SIGNAL</label>
            <input type="text" id="custPhone" placeholder="628XXXXXXXX">
            <label>ADDRESS</label>
            <textarea id="custAddr" rows="3" placeholder="ALAMAT LENGKAP..."></textarea>
        </div>

        <div class="panel">
            <label>SELECT_PRODUCT</label>
            <select id="orderProduct" onchange="updateValuation()">
                <option value="" disabled selected>PILIH PRODUK</option>
            </select>
            <label>SIZE</label>
            <select id="orderSize">
                <option value="S">S</option><option value="M">M</option>
                <option value="L">L</option><option value="XL">XL</option>
                <option value="ALL SIZE">ALL SIZE</option>
            </select>
            <div style="padding: 20px; background: #000; border: 1px solid #111; margin-bottom: 20px; border-radius: 12px;">
                <label>VALUATION</label>
                <div id="liveTotal" style="font-size: 24px; font-weight: 900; color: var(--m-green);">Rp 0</div>
            </div>
            <div class="btn-group">
                <button class="btn-main btn-invoice" onclick="generateInvoicePDF()">GENERATE_INVOICE</button>
                <button class="btn-main btn-label" onclick="printShippingLabel()">SHIPPING_LABEL</button>
            </div>
        </div>
    </div>
</div>

<div style="display:none;">
    <span id="resID"></span><span id="resName"></span><span id="resAddr"></span>
    <span id="resPhone"></span><span id="sumSubtotal"></span><span id="resTotal"></span>
    <span id="sumShippingCost">Rp 0</span>
</div>

<script>
    window.onload = () => {
        document.getElementById('orderDate').value = new Date().toLocaleDateString('id-ID');
        loadDatabase();
    };

    function loadDatabase() {
        const data = JSON.parse(localStorage.getItem('magos_products_data') || "[]");
        const select = document.getElementById('orderProduct');
        data.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p.id;
            opt.dataset.price = p.price;
            opt.text = `${p.id} | ${p.name}`;
            select.appendChild(opt);
        });
    }

    function updateValuation() {
        const select = document.getElementById('orderProduct');
        const price = parseInt(select.options[select.selectedIndex]?.dataset.price || 0);
        document.getElementById('liveTotal').innerText = "Rp " + price.toLocaleString('id-ID');
    }

    // FUNGSI INVOICE CUSTOM MAGOS
    function generateInvoicePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const select = document.getElementById('orderProduct');
        const price = parseInt(select.options[select.selectedIndex]?.dataset.price || 0);
        const name = document.getElementById('custName').value.toUpperCase();

        if(!name) return alert("INPUT_IDENTITY_REQUIRED");

        // Header Style
        doc.setFillColor(10, 10, 10);
        doc.rect(0, 0, 210, 40, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(22);
        doc.text("MAGOS ARCHIVE", 15, 25);
        
        doc.setFontSize(8);
        doc.text("ORDER_ID: " + document.getElementById('orderID').value, 150, 20);
        doc.text("DATE: " + document.getElementById('orderDate').value, 150, 25);

        // Content
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(10);
        doc.text("SHIP_TO:", 15, 55);
        doc.setFontSize(14);
        doc.text(name, 15, 65);
        doc.setFontSize(9);
        doc.text(document.getElementById('custAddr').value.toUpperCase(), 15, 72, { maxWidth: 100 });

        // Table
        doc.autoTable({
            startY: 90,
            head: [['DESCRIPTION', 'SIZE', 'PRICE', 'QTY', 'TOTAL']],
            body: [[select.options[select.selectedIndex].text.split('|')[1], document.getElementById('orderSize').value, "Rp " + price.toLocaleString('id-ID'), "1", "Rp " + price.toLocaleString('id-ID')]],
            theme: 'grid',
            headStyles: { fillColor: [0, 0, 0] }
        });

        doc.save(`INVOICE_${name.replace(/\s+/g, '_')}.pdf`);
    }

    // FUNGSI SHIPPING LABEL A6
    function printShippingLabel() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: [105, 148] });
        const name = document.getElementById('custName').value.toUpperCase();

        doc.rect(5, 5, 95, 138);
        doc.setFontSize(14);
        doc.text("MAGOS ARCHIVE", 10, 15);
        doc.line(5, 25, 100, 25);
        
        doc.setFontSize(8);
        doc.text("RECIPIENT:", 10, 35);
        doc.setFontSize(12);
        doc.text(name, 10, 45);
        doc.setFontSize(9);
        doc.text(document.getElementById('custAddr').value.toUpperCase(), 10, 52, { maxWidth: 85 });
        
        doc.save(`LABEL_${name.replace(/\s+/g, '_')}.pdf`);
    }
</script>
</body>
</html>